rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===== FONCTION D'AUTORISATION ADMIN =====
    // Liste des emails administrateurs autorisés
    // Gérer les admins directement dans Firebase Console
    function isAuthorizedAdmin() {
      return request.auth != null && request.auth.token.email in [
        'toumitony@gmail.com'
        // Ajoutez d'autres emails admin directement ici
        // 'autre.admin@example.com',
      ];
    }

    // Fonction pour vérifier si l'utilisateur est authentifié
    function isAuthenticated() {
      return request.auth != null;
    }

    // ===== COLLECTION PRODUCTS =====
    // Produits du site e-commerce
    match /products/{productId} {
      // Lecture : Public (pour affichage sur le site principal)
      allow read: if true;
      // Écriture : Seuls les admins autorisés (pour gestion via panneau admin)
      allow create, update, delete: if isAuthorizedAdmin();
    }

    // ===== COLLECTION ORDERS =====
    // Commandes des clients
    match /orders/{orderId} {
      // Lecture : Seuls les admins autorisés (pour gestion des commandes)
      allow read: if isAuthorizedAdmin();
      // Création : Public (pour que les clients puissent passer commande)
      allow create: if true;
      // Modification/Suppression : Seuls les admins autorisés
      allow update, delete: if isAuthorizedAdmin();
    }

    // ===== COLLECTION SETTINGS =====
    // Paramètres du site (informations générales, réseaux sociaux, etc.)
    match /settings/{settingId} {
      // Lecture : Admins autorisés + lecture publique pour le site principal
      allow read: if true; // Permet au site principal de charger les paramètres
      // Écriture : Seuls les admins autorisés
      allow write: if isAuthorizedAdmin();
    }

    // ===== RÈGLES PAR DÉFAUT =====
    // Toute autre collection non spécifiée est interdite par défaut
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// ===== INSTRUCTIONS D'APPLICATION =====
// 
// Pour appliquer ces règles :
// 1. Allez sur https://console.firebase.google.com/
// 2. Sélectionnez votre projet "rania-shop"
// 3. Allez dans "Firestore Database" > "Règles"
// 4. Remplacez le contenu existant par ce fichier
// 5. Cliquez sur "Publier"
// 
// Pour ajouter un nouvel administrateur :
// 1. Allez dans "Authentication" > "Users"
// 2. Cliquez sur "Add user"
// 3. Entrez l'email et le mot de passe
// 4. Ajoutez l'email dans la liste isAuthorizedAdmin() ci-dessus
// 5. Republiez les règles
//
// Ces règles simplifiées permettent :
// - Gestion des admins directement dans Firebase Console
// - Sécurité maintenue avec la liste d'emails autorisés
// - Pas de collection 'admins' nécessaire
// - Interface admin allégée et plus simple